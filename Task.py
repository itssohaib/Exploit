import asyncio
from playwright.async_api import async_playwright
import typer

app = typer.Typer()


@app.command()
def main(file_path: str):
    try:
        asyncio.run(upload(file_path))
    except Exception as e:
        typer.echo(f"An error occurred: {str(e)}")


async def upload(file_path: str):
    async with async_playwright() as p:
        browser = await p.firefox.launch(headless=False)
        page = await browser.new_page()
        await page.goto("https://google-gruyere.appspot.com/474321902912709775951276431102790481803/login")

        # Add your login code here
        await page.fill('input[name="uid"]', 'admin')
        await page.fill('input[name="pw"]', 'admin')
        await page.press('input[name="pw"]', 'Enter')
        await page.wait_for_load_state()

        print(await page.title())

        # Navigate to the upload page
        await page.goto("https://google-gruyere.appspot.com/474321902912709775951276431102790481803/upload.gtl")
        await page.wait_for_load_state()

        print(await page.title())

        # Upload the file
        await page.set_input_files('input[type="file"]', file_path)
        await page.click('input[value="Upload"]')
        await page.wait_for_load_state()

        print("File uploaded successfully")

        await browser.close()


if __name__ == "__main__":
    app()
